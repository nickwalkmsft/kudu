<Project Sdk="Microsoft.NET.Sdk.Web">
  <PropertyGroup>
    <TargetFramework>netcoreapp2.0</TargetFramework>
  </PropertyGroup>
  <ItemGroup>
    <PackageReference Include="Microsoft.AspNetCore.All" Version="2.0.0" />
    <PackageReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Design" Version="2.0.0" />
    <PackageReference Include="XmlSettings" Version="0.1.3" />
  </ItemGroup>
  <ItemGroup>
    <DotNetCliToolReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Tools" Version="2.0.0" />
  </ItemGroup>
  <ItemGroup>
    <ProjectReference Include="..\Kudu.Core\Kudu.Core.csproj" />
    <ProjectReference Include="..\Kudu.Services\Kudu.Services.csproj" />
  </ItemGroup>
  <ItemGroup>
    <Folder Include="Tracing\" />
  </ItemGroup>
  <!-- CORE TODO Lots of work to do here and in other .csproj files. Note we use AfterTargets="Build" now
  instead of Name="AfterBuild", and the paths to the nuget packages have changed" -->
  <Target Name="After-Build" AfterTargets="Build">
    <Message Text="Running post build events" Importance="High" />
    <ItemGroup>
      <KuduConsoleDependencies Include="$(SolutionDir)Kudu.Console\bin\$(ConfigurationName)\**\kudu.dll" />
      <KuduConsoleDependencies Include="$(SolutionDir)Kudu.Console\bin\$(ConfigurationName)\netcoreapp2.0\kudu.runtimeconfig.json" />
      <!-- Quick hack for dependencies needed for Kudu.Console run from the app root. This lets dependencies be resolved
           from my local nuget packages folders. I think the app needs to be published instead. -->
      <KuduConsoleDependencies Include="$(SolutionDir)Kudu.Console\bin\$(ConfigurationName)\netcoreapp2.0\kudu.runtimeconfig.dev.json" />
      <KuduConsoleDependencies Include="$(SolutionDir)Kudu.Console\bin\$(ConfigurationName)\netcoreapp2.0\kudu.deps.json" />
      <!--<KuduConsoleDependencies Include="$(NuGetPackageRoot)XmlSettings\**\XmlSettings.dll" />
      <KuduConsoleDependencies Include="$(NuGetPackageRoot)system.configuration.configurationmanager\**\netstandard2.0\System.Configuration.ConfigurationManager.dll" />-->
    </ItemGroup>
    <Copy SourceFiles="@(KuduConsoleDependencies)" DestinationFolder="$(TargetDir)" SkipUnchangedFiles="true" />
    <ItemGroup>
      <ScriptFilesToCopy Include="$(NuGetPackageRoot)KuduHandles\**\KuduHandles.exe" />
      <ScriptFilesToCopy Include="$(NuGetPackageRoot)KuduSync.NET\**\tools\*" />
    </ItemGroup>
    <Copy SourceFiles="@(ScriptFilesToCopy)" DestinationFolder="$(TargetDir)\Scripts" SkipUnchangedFiles="true" />
  </Target>
</Project>
